---
import { SITE } from '../config/site.ts';
import BaseLayout from '../layouts/BaseLayout.astro';
import Navigation from '../components/Navigation.astro';
import Footer from '../components/Footer.astro';
import resumeData from '../data/resume.json';

// Helper function to format dates
const formatDate = (dateString: string) => {
  if (!dateString) return '';
  if (dateString === 'Present') return 'Present';

  // Parse "Month Year" format
  const [month, year] = dateString.split(' ');
  const monthNames = {
    'Jan': 'Jan', 'Feb': 'Feb', 'Mar': 'Mar', 'Apr': 'Apr',
    'May': 'May', 'Jun': 'Jun', 'Jul': 'Jul', 'Aug': 'Aug',
    'Sep': 'Sep', 'Oct': 'Oct', 'Nov': 'Nov', 'Dec': 'Dec'
  };
  return `${monthNames[month]} ${year}`;
};

// Helper to get overall date range for a company
const getCompanyDateRange = (company: typeof resumeData.experience[0]) => {
  let firstStartDate: Date | null = null;
  let lastEndDate: Date | null = null;

  if (company.roles) {
    company.roles.forEach(role => {
      const currentStartDate = new Date(role.start_date);
      if (!firstStartDate || currentStartDate < firstStartDate) {
        firstStartDate = currentStartDate;
      }

      const currentEndDate = role.end_date === 'Present' ? new Date() : new Date(role.end_date);
      if (!lastEndDate || currentEndDate > lastEndDate) {
        lastEndDate = currentEndDate;
      }
    });
  } else {
    // Single role company
    firstStartDate = new Date(company.start_date);
    lastEndDate = company.end_date === 'Present' ? new Date() : new Date(company.end_date);
  }

  if (!firstStartDate || !lastEndDate) return '';

  const formattedFirstStartDate = formatDate(firstStartDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' }).replace(',', ''));
  const formattedLastEndDate = lastEndDate.getFullYear() === new Date().getFullYear() && lastEndDate.getMonth() === new Date().getMonth() ? 'Present' : formatDate(lastEndDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' }).replace(',', ''));

  return `${formattedFirstStartDate} - ${formattedLastEndDate}`;
};

// Community accomplishments (additional data not in LinkedIn JSON)
const accomplishments = [
  {
    "name": "Orlando Devs, Inc.",
    "position": "President",
    "when": "2016 - March 2018",
    "description": "Nonprofit focused on improving the quality of life of Software Professionals in Central Florida. The organization accompanies a community of over 3,000 members who actively engage both in person and online.",
    "url": "https://orlandodevs.com/"
  },
  {
    "name": "OrlandoJS",
    "position": "Co-organizer",
    "when": "2015 - March 2018",
    "description": "Tech meetup in Orlando that covers all things JavaScript and meets on a monthly basis.",
    "url": "https://meetup.com/OrlandoJS/"
  }
];

// Education (additional data not in LinkedIn JSON)
const education = [
  {
    "name": "University of Central Florida",
    "when": "2013-2015",
    "degree": "Bachelor's in Computer Science (Incomplete)"
  },
  {
    "name": "Valencia Community College", 
    "when": "2010-2013",
    "degree": "Associate of Arts"
  }
];
---

<BaseLayout title={`Resume - ${SITE.author}`} description={`Professional resume and experience of ${SITE.author}, Senior Engineering Leader with over 12 years of experience.`}>
  <Navigation />
  
  <main class="pt-16">
    <!-- Hero Section -->
    <section class="bg-white dark:bg-gray-900 py-24">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h1 class="text-4xl sm:text-5xl font-bold text-gray-900 dark:text-white mb-6">
          Resume
        </h1>
        <p class="text-xl text-gray-600 dark:text-gray-300 max-w-2xl mx-auto mb-8">
          {resumeData.title}
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a href="/sergio-cruz-resume.pdf" class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors">
            <svg class="mr-2 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            Download PDF
          </a>
          <a href="mailto:hello@sergio.io" class="inline-flex items-center px-6 py-3 border border-gray-300 dark:border-gray-600 text-base font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors">
            Contact Me
          </a>
        </div>
      </div>
    </section>

    <!-- Professional Summary -->
    <section class="bg-gray-50 dark:bg-gray-800 py-16">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">Professional Summary</h2>
        <div class="prose prose-lg dark:prose-invert max-w-none">
          <p class="text-gray-600 dark:text-gray-300 leading-relaxed">
            Senior Engineering Leader with over 12 years of experience building and scaling engineering organizations from startup to enterprise levels. Proven track record of leading teams from 2 to 40+ engineers while driving technical excellence, product outcomes, and business growth. Expert in modern web technologies, system architecture, and engineering management practices. Passionate about developing engineering talent, establishing scalable processes, and creating inclusive engineering cultures that deliver measurable business impact.
          </p>
        </div>
      </div>
    </section>

    <!-- Experience -->
    <section class="bg-white dark:bg-gray-900 py-16">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-8">Professional Experience</h2>
        
        <div class="space-y-10">
          {resumeData.experience.map((company, index) => (
            <div class="border-l-4 pl-6" class:list={[
              index === 0 ? 'border-primary-600' : 'border-gray-300 dark:border-gray-600'
            ]}>
              <div class="mb-4">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white">{company.company}</h3>
                <p class="text-primary-600 dark:text-primary-400 font-semibold mb-1">{company.location}</p>
                <span class="text-sm text-gray-500 dark:text-gray-400">{getCompanyDateRange(company)}</span>
              </div>

              {company.roles ? (
                // Multiple roles for this company
                <div class="space-y-6">
                  {company.roles.map(role => (
                    <div class="ml-4 border-l-2 border-gray-200 dark:border-gray-700 pl-4">
                      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-2">
                        <h4 class="text-lg font-bold text-gray-900 dark:text-white">{role.title}</h4>
                        <span class="text-sm text-gray-500 dark:text-gray-400">{formatDate(role.start_date)} - {formatDate(role.end_date)}</span>
                      </div>
                      <ul class="text-gray-600 dark:text-gray-300 space-y-2 mb-4">
                        {role.responsibilities.map(responsibility => (
                          <li>• {responsibility}</li>
                        ))}
                      </ul>
                    </div>
                  ))}
                </div>
              ) : (
                // Single role for this company
                <div>
                  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-2">
                    <h4 class="text-lg font-bold text-gray-900 dark:text-white">{company.title}</h4>
                    <span class="text-sm text-gray-500 dark:text-gray-400">{formatDate(company.start_date)} - {formatDate(company.end_date)}</span>
                  </div>
                  <ul class="text-gray-600 dark:text-gray-300 space-y-2 mb-4">
                    {company.responsibilities.map(responsibility => (
                      <li>• {responsibility}</li>
                    ))}
                  </ul>
                </div>
              )}
            </div>
          ))}
        </div>
      </div>
    </section>

    <!-- Community Involvement & Leadership -->
    <section class="bg-gray-50 dark:bg-gray-800 py-16">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-8">Community Involvement & Leadership</h2>
        
        <div class="space-y-6">
          {accomplishments.map((accomplishment) => (
            <div class="border-l-4 border-primary-600 pl-6">
              <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-2">
                <div class="flex items-center gap-2">
                  <h3 class="text-lg font-bold text-gray-900 dark:text-white">{accomplishment.name}</h3>
                  <span class="text-primary-600 dark:text-primary-400 font-medium">• {accomplishment.position}</span>
                </div>
                <span class="text-sm text-gray-500 dark:text-gray-400">{accomplishment.when}</span>
              </div>
              <p class="text-gray-600 dark:text-gray-300 mb-2">{accomplishment.description}</p>
              {accomplishment.url && (
                <a href={accomplishment.url} target="_blank" rel="noopener noreferrer" class="text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 text-sm font-medium">
                  Visit Website →
                </a>
              )}
            </div>
          ))}
        </div>
      </div>
    </section>

    <!-- Skills -->
    <section class="bg-white dark:bg-gray-900 py-16">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-8">Core Competencies</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          <div>
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Leadership & Management</h3>
            <div class="space-y-2">
              <div class="flex flex-wrap gap-2">
                <span class="px-3 py-1 bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 text-sm rounded-full">Engineering Management</span>
                <span class="px-3 py-1 bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 text-sm rounded-full">Team Scaling</span>
                <span class="px-3 py-1 bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 text-sm rounded-full">Technical Strategy</span>
                <span class="px-3 py-1 bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 text-sm rounded-full">Product Discovery</span>
                <span class="px-3 py-1 bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 text-sm rounded-full">OKRs & EOS</span>
              </div>
            </div>
          </div>
          
          <div>
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Frontend Technologies</h3>
            <div class="space-y-2">
              <div class="flex flex-wrap gap-2">
                <span class="px-3 py-1 bg-green/20 text-gray-800 dark:text-green text-sm rounded-full">React</span>
                <span class="px-3 py-1 bg-green/20 text-gray-800 dark:text-green text-sm rounded-full">TypeScript</span>
                <span class="px-3 py-1 bg-green/20 text-gray-800 dark:text-green text-sm rounded-full">JavaScript</span>
                <span class="px-3 py-1 bg-green/20 text-gray-800 dark:text-green text-sm rounded-full">Angular</span>
                <span class="px-3 py-1 bg-green/20 text-gray-800 dark:text-green text-sm rounded-full">Ruby on Rails</span>
              </div>
            </div>
          </div>
          
          <div>
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Backend & Infrastructure</h3>
            <div class="space-y-2">
              <div class="flex flex-wrap gap-2">
                <span class="px-3 py-1 bg-pink/20 text-gray-800 dark:text-pink text-sm rounded-full">Node.js</span>
                <span class="px-3 py-1 bg-pink/20 text-gray-800 dark:text-pink text-sm rounded-full">PHP</span>
                <span class="px-3 py-1 bg-pink/20 text-gray-800 dark:text-pink text-sm rounded-full">AWS</span>
                <span class="px-3 py-1 bg-pink/20 text-gray-800 dark:text-pink text-sm rounded-full">Docker</span>
                <span class="px-3 py-1 bg-pink/20 text-gray-800 dark:text-pink text-sm rounded-full">CI/CD</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Education -->
    <section class="bg-gray-50 dark:bg-gray-800 py-16">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-8">Education</h2>
        
        <div class="space-y-6">
          {education.map((edu, index) => (
            <div class={`border-l-4 ${index === 0 ? 'border-primary-600' : 'border-gray-300 dark:border-gray-600'} pl-6`}>
              <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-2">
                <h3 class="text-lg font-bold text-gray-900 dark:text-white">{edu.degree}</h3>
                <span class="text-sm text-gray-500 dark:text-gray-400">{edu.when}</span>
              </div>
              <p class="text-primary-600 dark:text-primary-400 font-semibold">{edu.name}</p>
            </div>
          ))}
        </div>
      </div>
    </section>
  </main>
  
  <Footer />
</BaseLayout>